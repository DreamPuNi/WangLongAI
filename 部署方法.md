# Gewechat部署

## 注意事项

部署Gewechat的电脑的ip必须和你常驻省份一致！

## 部署方法

- 首先安装 external 里面的docker-desktop应用
- 安装完成后运行如下代码
```commandline
# 从阿里云镜像仓库拉取(国内)
docker pull registry.cn-chengdu.aliyuncs.com/tu1h/wechotd:alpine
docker tag registry.cn-chengdu.aliyuncs.com/tu1h/wechotd:alpine gewe

# 创建数据目录并启动服务
mkdir -p gewechat/data  
docker run -itd -v ./gewechat/data:/root/temp -p 2531:2531 -p 2532:2532 --restart=always --name=gewe gewe
```

```commandline
mkdir gewechat\data
docker run -itd -v C:\Users\龙崎盈子\gewechat\data:/root/temp -p 2531:2531 -p 2532:2532 --restart=always --name=gewe gewe
```
gewechat相关配置如下，注意**channel_type设置为gewechat**

```bash 
{
    "channel_type": "gewechat",  # 通道类型设置为gewechat    
    "gewechat_token": "",        # 首次登录可留空,自动获取
    "gewechat_app_id": "",       # 首次登录可留空,自动获取
    "gewechat_base_url": "http://本机ip:2531/v2/api",  # gewechat服务API地址
    "gewechat_callback_url": "http://本机ip:9919/v2/api/callback/collect", # 回调地址
    "gewechat_download_url": "http://本机ip:2532/download" # 文件下载地址
}
```

> 本机ip是指**局域网ip**或**公网ip**，可通过`ipconfig`或`ifconfig`命令查看
> 
> 对与gewechat_callback_url，ip不能填`127.0.0.1`或`localhost`，否则会报错
> 
> `9919`端口是dify-on-wechat服务监听的端口，如果是用docker启动的dify-on-wechat服务,请把`9919`端口映射到宿主机

# Dify部署

```commandline
git clone https://github.com/langgenius/dify.git
cd dify
docker-compose up -d
```

运行之后你可以在 http://localhost/sigin 看到对应的页面

# 企微模拟按键接入

安装 external 下的 jdk-23_windows 文件

然后去channel里面的sikuli看详细说明

# 打包方法

打包的文件记得带上plugin库和其他的相关文件，同时记得弄user下面的.flet文件他喵的

这个是包含flet和wcf的打包代码
```commandline
pyinstaller --onefile --noconsole --name=LongShangAI --add-data "D:\\Program\\0-venv\\dify-on-wechat-env\\Lib\\site-packages\\flet;flet" --add-data "D:\\Program\\0-venv\\dify-on-wechat-env\\Lib\\site-packages\\wcferry;wcferry" --add-data "D:\\Program\\0-venv\\dify-on-wechat-env\\Lib\\site-packages\\wcferry\\sdk.dll;wcferry" --add-data "D:\\Program\\dify-on-wechat\\plugins;plugins" interface.py
```


